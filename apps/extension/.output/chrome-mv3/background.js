var background=(function(){"use strict";function W(r){return r==null||typeof r=="function"?{main:r}:r}function U(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var T={exports:{}},D=T.exports,F;function K(){return F||(F=1,(function(r,t){(function(o,c){c(r)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:D,function(o){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)o.exports=globalThis.browser;else{const c="The message port closed before a response was received.",p=A=>{const w={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(w).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class b extends WeakMap{constructor(s,i=void 0){super(i),this.createItem=s}get(s){return this.has(s)||this.set(s,this.createItem(s)),super.get(s)}}const k=e=>e&&typeof e=="object"&&typeof e.then=="function",P=(e,s)=>(...i)=>{A.runtime.lastError?e.reject(new Error(A.runtime.lastError.message)):s.singleCallbackArg||i.length<=1&&s.singleCallbackArg!==!1?e.resolve(i[0]):e.resolve(i)},y=e=>e==1?"argument":"arguments",O=(e,s)=>function(a,...l){if(l.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${y(s.minArgs)} for ${e}(), got ${l.length}`);if(l.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${y(s.maxArgs)} for ${e}(), got ${l.length}`);return new Promise((u,x)=>{if(s.fallbackToNoCallback)try{a[e](...l,P({resolve:u,reject:x},s))}catch(n){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,n),a[e](...l),s.fallbackToNoCallback=!1,s.noCallback=!0,u()}else s.noCallback?(a[e](...l),u()):a[e](...l,P({resolve:u,reject:x},s))})},L=(e,s,i)=>new Proxy(s,{apply(a,l,u){return i.call(l,e,...u)}});let E=Function.call.bind(Object.prototype.hasOwnProperty);const M=(e,s={},i={})=>{let a=Object.create(null),l={has(x,n){return n in e||n in a},get(x,n,d){if(n in a)return a[n];if(!(n in e))return;let g=e[n];if(typeof g=="function")if(typeof s[n]=="function")g=L(e,e[n],s[n]);else if(E(i,n)){let v=O(n,i[n]);g=L(e,e[n],v)}else g=g.bind(e);else if(typeof g=="object"&&g!==null&&(E(s,n)||E(i,n)))g=M(g,s[n],i[n]);else if(E(i,"*"))g=M(g,s[n],i["*"]);else return Object.defineProperty(a,n,{configurable:!0,enumerable:!0,get(){return e[n]},set(v){e[n]=v}}),g;return a[n]=g,g},set(x,n,d,g){return n in a?a[n]=d:e[n]=d,!0},defineProperty(x,n,d){return Reflect.defineProperty(a,n,d)},deleteProperty(x,n){return Reflect.deleteProperty(a,n)}},u=Object.create(e);return new Proxy(u,l)},_=e=>({addListener(s,i,...a){s.addListener(e.get(i),...a)},hasListener(s,i){return s.hasListener(e.get(i))},removeListener(s,i){s.removeListener(e.get(i))}}),H=new b(e=>typeof e!="function"?e:function(i){const a=M(i,{},{getContent:{minArgs:0,maxArgs:0}});e(a)}),j=new b(e=>typeof e!="function"?e:function(i,a,l){let u=!1,x,n=new Promise(S=>{x=function(h){u=!0,S(h)}}),d;try{d=e(i,a,x)}catch(S){d=Promise.reject(S)}const g=d!==!0&&k(d);if(d!==!0&&!g&&!u)return!1;const v=S=>{S.then(h=>{l(h)},h=>{let B;h&&(h instanceof Error||typeof h.message=="string")?B=h.message:B="An unexpected error occurred",l({__mozWebExtensionPolyfillReject__:!0,message:B})}).catch(h=>{console.error("Failed to send onMessage rejected reply",h)})};return v(g?d:n),!0}),Q=({reject:e,resolve:s},i)=>{A.runtime.lastError?A.runtime.lastError.message===c?s():e(new Error(A.runtime.lastError.message)):i&&i.__mozWebExtensionPolyfillReject__?e(new Error(i.message)):s(i)},q=(e,s,i,...a)=>{if(a.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${y(s.minArgs)} for ${e}(), got ${a.length}`);if(a.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${y(s.maxArgs)} for ${e}(), got ${a.length}`);return new Promise((l,u)=>{const x=Q.bind(null,{resolve:l,reject:u});a.push(x),i.sendMessage(...a)})},X={devtools:{network:{onRequestFinished:_(H)}},runtime:{onMessage:_(j),onMessageExternal:_(j),sendMessage:q.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:q.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},I={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return w.privacy={network:{"*":I},services:{"*":I},websites:{"*":I}},M(A,X,w)};o.exports=p(chrome)}})})(T)),T.exports}var z=K();const m=U(z),V=W(()=>{console.log("Cortex background worker started"),m.runtime.onInstalled.addListener(()=>{m.contextMenus.create({id:"save-to-cortex",title:"Save to Cortex",contexts:["page","selection","link"]}),m.contextMenus.create({id:"save-selection",title:"Save selection to Cortex",contexts:["selection"]})}),m.contextMenus.onClicked.addListener(async(r,t)=>{t!=null&&t.id&&(r.menuItemId==="save-to-cortex"?await $(t.id,t):r.menuItemId==="save-selection"&&r.selectionText&&await R(t.id,r.selectionText,t))}),m.commands.onCommand.addListener(async r=>{var o;const[t]=await m.tabs.query({active:!0,currentWindow:!0});if(t!=null&&t.id&&r==="quick_save"){const p=(o=(await m.scripting.executeScript({target:{tabId:t.id},func:()=>{var A;return((A=window.getSelection())==null?void 0:A.toString())||""}}))[0])==null?void 0:o.result;p?await R(t.id,p,t):await $(t.id,t)}}),m.runtime.onMessage.addListener(async(r,t)=>{if(r.type==="SAVE_PAGE"){const o=t.tab||(await m.tabs.query({active:!0,currentWindow:!0}))[0];o!=null&&o.id&&await $(o.id,o,r.data)}else r.type==="SAVE_TWEET"&&await Z(r.data)})});async function $(r,t,o){var c,p,A;try{const b=(c=(await m.scripting.executeScript({target:{tabId:r},func:G}))[0])==null?void 0:c.result;if(!b){f("Error","Could not extract page content");return}const{apiKey:k}=await m.storage.local.get("apiKey");if(!k){f("Not logged in","Please configure your API key in settings"),m.runtime.openOptionsPage();return}const P=((p=t.url)==null?void 0:p.includes("twitter.com"))||((A=t.url)==null?void 0:A.includes("x.com")),y=await fetch("https://askcortex.plutas.in/v3/memories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({content:b.content,metadata:{source:"chrome_extension",url:t.url,title:t.title||b.title,favicon:t.favIconUrl,timestamp:new Date().toISOString(),type:P?"tweet":"webpage",...o}})});if(!y.ok)throw new Error(`API error: ${y.status}`);const O=await y.json();f("Saved to Cortex",`"${(t.title||"").substring(0,50)}..."`),m.tabs.sendMessage(r,{type:"SAVE_SUCCESS",data:O})}catch(w){console.error("Failed to save page:",w),f("Save failed","Please try again")}}async function R(r,t,o){try{const{apiKey:c}=await m.storage.local.get("apiKey");if(!c){f("Not logged in","Please configure your API key");return}await fetch("https://askcortex.plutas.in/v3/memories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({content:t,metadata:{source:"chrome_extension_selection",url:o.url,title:o.title,timestamp:new Date().toISOString()}})}),f("Selection saved",t.substring(0,50)+"...")}catch(c){console.error("Failed to save selection:",c),f("Save failed","Please try again")}}async function Z(r){try{const{apiKey:t}=await m.storage.local.get("apiKey");if(!t){f("Not logged in","Please configure your API key");return}await fetch("https://askcortex.plutas.in/v3/memories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({content:r.text,metadata:{source:"twitter",type:"tweet",author:r.author,url:r.url,timestamp:r.timestamp||new Date().toISOString()}})}),f("Tweet saved",`From @${r.author}`)}catch(t){console.error("Failed to save tweet:",t),f("Save failed","Please try again")}}function f(r,t){m.notifications.create({type:"basic",iconUrl:m.runtime.getURL("/icon/128.png"),title:r,message:t})}function G(){var b,k;const r=document.title,t=((b=document.querySelector('meta[name="description"]'))==null?void 0:b.getAttribute("content"))||"",o=((k=document.querySelector('meta[property="og:image"]'))==null?void 0:k.getAttribute("content"))||"",c=document.querySelector("article"),p=document.querySelector("main"),A=c||p||document.body,w=(A==null?void 0:A.innerText.replace(/\s+/g," ").trim().substring(0,1e4))||"";return{title:r,description:t,ogImage:o,content:w,url:window.location.href}}function ee(){}function C(r,...t){}const J={debug:(...r)=>C(console.debug,...r),log:(...r)=>C(console.log,...r),warn:(...r)=>C(console.warn,...r),error:(...r)=>C(console.error,...r)};let N;try{N=V.main(),N instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw J.error("The background crashed on startup!"),r}return N})();
background;
